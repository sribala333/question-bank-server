generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model country {
  country_id   Int     @id @default(autoincrement())
  name         String  @db.VarChar(100)
  country_code String  @db.Char(3)
  phone_code   String? @db.VarChar(6)
  active       Boolean
}

model department_role_trans {
  dept_role_id               Int                          @id @default(autoincrement())
  department_id              Int
  role_id                    Int
  active                     Boolean?
  departments                departments                  @relation(fields: [department_id], references: [department_id], onDelete: Cascade, onUpdate: NoAction)
  roles                      roles                        @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction)
  role_permissions           role_permissions[]
  user_department_role_trans user_department_role_trans[]

  @@unique([department_id, role_id])
}

model departments {
  department_id         Int                     @id @default(autoincrement())
  department_name       String                  @unique @db.VarChar(255)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  department_role_trans department_role_trans[]
}

model modules {
  module_id   Int       @id @default(autoincrement())
  module_name String    @unique @db.VarChar(255)
  icon        String?   @db.VarChar(70)
  order_no    Int       @db.SmallInt
  screens     screens[]
}

model role_permissions {
  role_permission_id    Int                   @id @default(autoincrement())
  screen_id             Int
  dept_role_id          Int
  can_create            Boolean?              @default(false)
  can_edit              Boolean?              @default(false)
  can_view              Boolean?              @default(true)
  can_delete            Boolean?              @default(false)
  department_role_trans department_role_trans @relation(fields: [dept_role_id], references: [dept_role_id], onDelete: Cascade, onUpdate: NoAction)
  screens               screens               @relation(fields: [screen_id], references: [screen_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([screen_id, dept_role_id])
}

model roles {
  role_id               Int                     @id @default(autoincrement())
  role_name             String                  @unique @db.VarChar(100)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  department_role_trans department_role_trans[]
}

model screens {
  screen_id        Int                @id @default(autoincrement())
  screen_name      String             @unique @db.VarChar(255)
  module_id        Int
  order_no         Int                @db.SmallInt
  route_url        String             @db.VarChar(700)
  icon             String?            @db.VarChar(70)
  role_permissions role_permissions[]
  modules          modules            @relation(fields: [module_id], references: [module_id], onDelete: Cascade, onUpdate: NoAction)
}

model user_department_role_trans {
  user_dept_role_id     Int                   @id @default(autoincrement())
  user_id               Int
  dept_role_id          Int
  active                Boolean?
  department_role_trans department_role_trans @relation(fields: [dept_role_id], references: [dept_role_id], onDelete: Cascade, onUpdate: NoAction)
  users                 users                 @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, dept_role_id])
}

model users {
  user_id                    Int                          @id @default(autoincrement())
  user_name                  String                       @db.VarChar(100)
  email                      String                       @unique @db.VarChar(255)
  password_hash              String
  active                     Boolean?
  created_at                 DateTime?                    @default(now()) @db.Timestamp(6)
  profile_picture            String?
  user_department_role_trans user_department_role_trans[]
}
